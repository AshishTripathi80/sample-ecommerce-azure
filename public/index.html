<!DOCTYPE html>
<html>
<head>
  <title>Sample E-Commerce</title>
</head>
<body>
  <h1>Welcome to Sample E-Commerce</h1>
  <p>Here are some products:</p>
  <ul id="product-list"></ul>

  <h3>Product Image (from Blob Storage):</h3>
  <img id="product-image" width="200" alt="Loading..." />

  <script>
    // Load product image from blob storage
    fetch("/api/images/Laptop.jpg")
      .then(res => res.json())
      .then(data => {
        document.getElementById("product-image").src = data.imageUrl;
      })
      .catch(err => {
        console.error('Error loading image:', err);
        document.getElementById("product-image").alt = "Failed to load image";
      });

    // Load products
    fetch("/api/products")
      .then(res => res.json())
      .then(products => {
        const list = document.getElementById("product-list");
        products.forEach(p => {
          const item = document.createElement("li");
  
          const name = p.Name || p.name || 'Unknown Product';
          const price = p.Price || p.price || 'N/A';
  
          item.textContent = `${name} - $${price} `;
  
          // Create order button
          const btn = document.createElement("button");
          btn.textContent = "Order";
          btn.onclick = async () => {
            try {
              const response = await fetch("/api/orders", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ productId: p.Id || p.id, quantity: 1 })
              });
              const result = await response.json();
              alert(result.message || "Order processed");
            } catch (err) {
              alert("Failed to place order");
              console.error(err);
            }
          };
  
          item.appendChild(btn);
          list.appendChild(item);
        });
      })
      .catch(err => {
        console.error('Error fetching products:', err);
        document.getElementById("product-list").innerHTML = '<li>Error loading products</li>';
      });
  </script>
  
</body>
</html>